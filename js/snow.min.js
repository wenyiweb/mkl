(function(){var c=0;var b=["webkit","moz"];for(var a=0;a<b.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[b[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[b[a]+"CancelAnimationFrame"]||window[b[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(g,e){var d=new Date().getTime();var f=Math.max(0,16-(d-c));var h=window.setTimeout(function(){g(d+f)},f);c=d+f;return h}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());(function(a){a.snowfall=function(n,j){var o={flakeCount:35,flakeColor:"#ffffff",flakePosition:"absolute",flakeIndex:999999,minSize:1,maxSize:2,minSpeed:1,maxSpeed:5,round:false,shadow:false,collection:false,collectionHeight:40,deviceorientation:false},j=a.extend(o,j),r=function r(w,i){return Math.round(w+Math.random()*(i-w))};a(n).data("snowfall",this);function d(A,z,w,C,B){this.id=B;this.x=A;this.y=z;this.size=w;this.speed=C;this.step=0;this.stepSize=r(1,10)/100;if(j.collection){this.target=t[r(0,t.length-1)]}var i=null;if(j.image){i=a(document.createElement("img"));i[0].src=j.image}else{i=a(document.createElement("div"));i.css({background:j.flakeColor})}i.attr({"class":"snowfall-flakes",id:"flake-"+this.id}).css({width:this.size,height:this.size,position:j.flakePosition,top:this.y,left:this.x,fontSize:0,zIndex:j.flakeIndex});if(a(n).get(0).tagName===a(document).get(0).tagName){a("body").append(i);n=a("body")}else{a(n).append(i)}this.element=document.getElementById("flake-"+this.id);this.update=function(){this.y+=this.speed;if(this.y>(c)-(this.size+6)){this.reset()}this.element.style.top=this.y+"px";this.element.style.left=this.x+"px";this.step+=this.stepSize;if(h===false){this.x+=Math.cos(this.step)}else{this.x+=(h+Math.cos(this.step))}if(j.collection){if(this.x>this.target.x&&this.x<this.target.width+this.target.x&&this.y>this.target.y&&this.y<this.target.height+this.target.y){var F=this.target.element.getContext("2d"),E=this.x-this.target.x,D=this.y-this.target.y,G=this.target.colData;if(G[parseInt(E)][parseInt(D+this.speed+this.size)]!==undefined||D+this.speed+this.size>this.target.height){if(D+this.speed+this.size>this.target.height){while(D+this.speed+this.size>this.target.height&&this.speed>0){this.speed*=0.5}F.fillStyle="#fff";if(G[parseInt(E)][parseInt(D+this.speed+this.size)]==undefined){G[parseInt(E)][parseInt(D+this.speed+this.size)]=1;F.fillRect(E,(D)+this.speed+this.size,this.size,this.size)}else{G[parseInt(E)][parseInt(D+this.speed)]=1;F.fillRect(E,D+this.speed,this.size,this.size)}this.reset()}else{this.speed=1;this.stepSize=0;if(parseInt(E)+1<this.target.width&&G[parseInt(E)+1][parseInt(D)+1]==undefined){this.x++}else{if(parseInt(E)-1>0&&G[parseInt(E)-1][parseInt(D)+1]==undefined){this.x--}else{F.fillStyle="#fff";F.fillRect(E,D,this.size,this.size);G[parseInt(E)][parseInt(D)]=1;this.reset()}}}}}}if(this.x>(y)-g||this.x<g){this.reset()}};this.reset=function(){this.y=0;this.x=r(g,y-g);this.stepSize=r(1,10)/100;this.size=r((j.minSize*100),(j.maxSize*100))/100;this.speed=r(j.minSpeed,j.maxSpeed)}}var v=[],q=0,u=0,c=a(n).height(),y=a(n).width(),g=0,s=0;if(j.collection!==false){var k=document.createElement("canvas");if(!!(k.getContext&&k.getContext("2d"))){var t=[],b=a(j.collection),x=j.collectionHeight;for(var u=0;u<b.length;u++){var f=b[u].getBoundingClientRect(),l=document.createElement("canvas"),m=[];if(f.top-x>0){document.body.appendChild(l);l.style.position=j.flakePosition;l.height=x;l.width=f.width;l.style.left=f.left+"px";l.style.top=f.top-x+"px";for(var p=0;p<f.width;p++){m[p]=[]}t.push({element:l,x:f.left,y:f.top-x,width:f.width,height:x,colData:m})}}}else{j.collection=false}}if(a(n).get(0).tagName===a(document).get(0).tagName){g=25}a(window).bind("resize",function(){c=a(n)[0].clientHeight;y=a(n)[0].offsetWidth});for(u=0;u<j.flakeCount;u+=1){q=v.length;v.push(new d(r(g,y-g),r(0,c),r((j.minSize*100),(j.maxSize*100))/100,r(j.minSpeed,j.maxSpeed),q))}if(j.round){a(".snowfall-flakes").css({"-moz-border-radius":j.maxSize,"-webkit-border-radius":j.maxSize,"border-radius":j.maxSize})}if(j.shadow){a(".snowfall-flakes").css({"-moz-box-shadow":"1px 1px 1px #555","-webkit-box-shadow":"1px 1px 1px #555","box-shadow":"1px 1px 1px #555"})}var h=false;if(j.deviceorientation){a(window).bind("deviceorientation",function(i){h=i.originalEvent.gamma*0.1})}function e(){for(u=0;u<v.length;u+=1){v[u].update()}s=requestAnimationFrame(function(){e()})}e();this.clear=function(){a(n).children(".snowfall-flakes").remove();v=[];cancelAnimationFrame(s)}};a.fn.snowfall=function(b){if(typeof(b)=="object"||b==undefined){return this.each(function(c){(new a.snowfall(this,b))})}else{if(typeof(b)=="string"){return this.each(function(c){var d=a(this).data("snowfall");if(d){d.clear()}})}}}})(jQuery);